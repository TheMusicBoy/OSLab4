# Лабораторная работа 4: Система мониторинга температурных данных

Система для сбора, анализа и визуализации температурных данных.

## Архитектура системы

Система построена на основе компонентной архитектуры с интрузивными указателями для управления памятью:

- Модуль `common` - базовые компоненты (умные указатели, логирование, исключения)
- Модуль `ipc` - межпроцессное взаимодействие (последовательный порт, базы данных)
- Модуль `service` - основная логика сервиса

## Сборка и запуск

```bash
# Сборка проекта
mkdir build && cd build
cmake -DCMAKE_BUILD_TYPE=Release ..
cmake --build .

# Запуск основной службы с конфигурацией
./main -c config.json

# Ускорение процесса (для тестирования)
./main -c config.json -a 60.0
```

## Основные возможности

- Файловое хранилище
- Чтение данных с последовательного порта (кросс-платформенный код)
- Автоматическая агрегация и очистка данных:
  - Сырые данные: хранение 24 часа
  - Часовые средние: хранение 30 дней
  - Дневные средние: хранение 365 дней
- Гибкая система логирования

## Конфигурация

```json
{
    "mesure_delay": 10,
    "serial": {
        "serial_port": "/tmp/tty58",
        "baud_rate": 115200
    },
    "storage": {
        "file_system": {
            "temperature": "data/current.log",
            "hourly": "data/hourly_avg.log",
            "daily": "data/daily_avg.log"
        }
    },
    "logging": [
        {
            "level": "Debug",
            "path": "debug.log"
        },
        {
            "level": "Error",
            "path": "error.log"
        }
    ]
}
```

## Симулятор данных

Для тестирования системы без реального датчика можно использовать симулятор, который генерирует реалистичные температурные данные.

### Примеры запуска

```bash
# С конфигурационным файлом
./tools/simulator -c simulator_config.json

# С параметрами командной строки
./tools/simulator -p /dev/ttyUSB0 -b 115200 -m 60.0

# Ускоренная симуляция (1 год за 6 часов)
./tools/simulator -c base_config.json -m 1460
```

### Параметры симулятора

```json
{
    "serial": {
        "serial_port": "COM3",
        "baud_rate": 9600
    },
    "time_multiplier": 60.0
}
```

- `-c/--config` - путь к файлу конфигурации
- `-p/--port` - путь к последовательному порту (COM3, /dev/ttyUSB0)
- `-b/--baud` - скорость порта (9600, 115200)
- `-m/--multiplier` - множитель времени (для ускорения симуляции)

## Структура хранимых данных

### Формат данных
- Каждая запись в отдельной строке
- Формат: `YYYY-MM-DDTHH:MM:SSZ значение`
- Автоматическая ротация данных по времени

## Проверка работы

1. Запустите сервис: `./main -c config.json`
2. Запустите симулятор: `./tools/simulator -p /dev/ttyUSB0 -b 115200`
3. Проверьте данные указанные в конфиге для хранения данных

## Технические особенности

- Кросс-платформенная поддержка (Windows, Linux, macOS)
- Система умных указателей с подсчетом ссылок
- Управление жизненным циклом объектов
- Асинхронная обработка запросов
- Потокобезопасное хранение и обновление данных
- Обработка исключений и логирование ошибок
