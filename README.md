# Лабораторная работа 4: Система мониторинга температурных данных

Система для сбора, анализа и визуализации температурных данных.

## Архитектура системы

Система построена на основе компонентной архитектуры с интрузивными указателями для управления памятью:

Общие компоненты:
- **common** - базовые утилиты (умные указатели, логирование, исключения)
- **ipc** - межпроцессное взаимодействие (последовательный порт, базы данных)
- **rpc** - HTTP сервер и обработчики запросов
- **service** - основная логика

## Сборка и запуск

```bash
# Сборка проекта
mkdir build && cd build
cmake -DCMAKE_BUILD_TYPE=Release ..
cmake --build .

# Запуск основной службы с конфигурацией
./main -c config.json

# Ускорение процесса (для тестирования)
./main -c config.json -a 60.0
```

## Основные возможности

- Файловое хранилище
- Чтение данных с последовательного порта (кросс-платформенный код)
- Автоматическая агрегация и очистка данных:
  - Сырые данные: хранение 24 часа
  - Часовые средние: хранение 30 дней
  - Дневные средние: хранение 365 дней
- Гибкая система логирования

## Конфигурация

### Сервис (config.json)

```json
{
    "mesure_delay": 10,
    "serial": {
        "serial_port": "/dev/ttyUSB0",
        "baud_rate": 115200,
        "format": "text"
    },
    "storage": {
        "file_system": {
            "temperature": "data/current.log",
            "hourly": "data/hourly_avg.log",
            "daily": "data/daily_avg.log"
        }
    },
    "logging": [
        {
            "level": "Debug",
            "path": "debug.log"
        },
        {
            "level": "Error",
            "path": "error.log"
        }
    ]
}
```

### Симулятор (simulator_config.json)

```json
{
    "serial": {
        "serial_port": "COM3",
        "baud_rate": 9600,
        "format": "text"
    },
    "time_multiplier": 60.0,
    "delay_ms": 100
}
```

## Симулятор данных

Для тестирования системы без реального датчика используйте симулятор температурных данных:

```bash
# С конфигурационным файлом
./simulator -c simulator_config.json

# С параметрами командной строки
./simulator -p /dev/ttyUSB0 -b 115200 -m 60.0

# Ускоренная симуляция (1 год за 6 часов)
./simulator -c simulator_config.json -m 1460
```

Параметры симулятора:
- `-c/--config` - путь к файлу конфигурации
- `-p/--port` - путь к последовательному порту (COM3, /dev/ttyUSB0)
- `-b/--baud` - скорость порта (9600, 115200)
- `-m/--multiplier` - множитель времени (для ускорения симуляции)

## Форматы данных для последовательного порта

Система поддерживает несколько форматов данных для передачи температуры через последовательный порт:

1. **text** (по умолчанию) - Текстовый формат, температура передается как ASCII строка с десятичным числом.
   Пример: `23.5`

2. **byte_integer** - 1-байтовый целочисленный двоичный формат. 
   Температура передается как одно целое число в диапазоне от -127 до 128.
   Подходит для простых датчиков с низкой точностью.

3. **fixed_point** - 2-байтовый формат с фиксированной точкой (точность 0.1°C).
   Температура передается как 16-битное целое число, умноженное на 10.
   Подходит для передачи температур от -3276.8°C до 3276.7°C с точностью 0.1°C.

4. **floating_point** - 4-байтовый формат IEEE754 с плавающей точкой.
   Температура передается как 32-битное число с плавающей точкой.
   Обеспечивает наибольшую точность и диапазон.

## Структура хранимых данных

### Формат данных
- Каждая запись в отдельной строке
- Формат: `YYYY-MM-DDTHH:MM:SSZ значение`
- Автоматическая ротация данных по времени

## Проверка работы

1. Запустите сервис: `./main -c config.json`
2. Запустите симулятор: `./tools/simulator -p /dev/ttyUSB0 -b 115200`
3. Проверьте данные указанные в конфиге для хранения данных

## Технические особенности

- Кросс-платформенная поддержка (Windows, Linux, macOS)
- Система интрузивных умных указателей с подсчетом ссылок
- Поддержка разных форматов входных данных
- Управление жизненным циклом объектов
- Асинхронная обработка запросов
- Потокобезопасное хранение и обновление данных
- Обработка исключений и гибкая система логирования
